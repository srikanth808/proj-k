{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useState, useCallback } from 'react';\nexport const useWebSocket = ({\n  url,\n  onMessage,\n  onOpen,\n  onClose,\n  onError,\n  reconnectAttempts = 5,\n  reconnectInterval = 3000\n}) => {\n  _s();\n  const [isConnected, setIsConnected] = useState(false);\n  const [lastMessage, setLastMessage] = useState(null);\n  const ws = useRef(null);\n  const reconnectTimeoutId = useRef(null);\n  const reconnectCount = useRef(0);\n  const connect = useCallback(() => {\n    try {\n      ws.current = new WebSocket(url);\n      ws.current.onopen = () => {\n        setIsConnected(true);\n        reconnectCount.current = 0;\n        onOpen === null || onOpen === void 0 ? void 0 : onOpen();\n      };\n      ws.current.onmessage = event => {\n        try {\n          const message = JSON.parse(event.data);\n          setLastMessage(message);\n          onMessage === null || onMessage === void 0 ? void 0 : onMessage(message);\n        } catch (error) {\n          console.error('Failed to parse WebSocket message:', error);\n        }\n      };\n      ws.current.onclose = () => {\n        setIsConnected(false);\n        onClose === null || onClose === void 0 ? void 0 : onClose();\n\n        // Attempt to reconnect if not at max attempts\n        if (reconnectCount.current < reconnectAttempts) {\n          reconnectCount.current += 1;\n          reconnectTimeoutId.current = setTimeout(() => {\n            connect();\n          }, reconnectInterval);\n        }\n      };\n      ws.current.onerror = error => {\n        console.error('WebSocket error:', error);\n        onError === null || onError === void 0 ? void 0 : onError(error);\n      };\n    } catch (error) {\n      console.error('Failed to create WebSocket connection:', error);\n    }\n  }, [url, onMessage, onOpen, onClose, onError, reconnectAttempts, reconnectInterval]);\n  const disconnect = useCallback(() => {\n    if (reconnectTimeoutId.current) {\n      clearTimeout(reconnectTimeoutId.current);\n    }\n    if (ws.current) {\n      ws.current.close();\n    }\n  }, []);\n  const sendMessage = useCallback(message => {\n    if (ws.current && ws.current.readyState === WebSocket.OPEN) {\n      ws.current.send(JSON.stringify(message));\n    } else {\n      console.warn('WebSocket is not connected');\n    }\n  }, []);\n  useEffect(() => {\n    connect();\n    return () => {\n      disconnect();\n    };\n  }, [connect, disconnect]);\n  return {\n    isConnected,\n    lastMessage,\n    sendMessage,\n    disconnect,\n    reconnect: connect\n  };\n};\n_s(useWebSocket, \"IVTJZZsi/W8/bGKvmP0BhrWDMXw=\");","map":{"version":3,"names":["useEffect","useRef","useState","useCallback","useWebSocket","url","onMessage","onOpen","onClose","onError","reconnectAttempts","reconnectInterval","_s","isConnected","setIsConnected","lastMessage","setLastMessage","ws","reconnectTimeoutId","reconnectCount","connect","current","WebSocket","onopen","onmessage","event","message","JSON","parse","data","error","console","onclose","setTimeout","onerror","disconnect","clearTimeout","close","sendMessage","readyState","OPEN","send","stringify","warn","reconnect"],"sources":["S:/proj k/frontend/src/hooks/useWebSocket.ts"],"sourcesContent":["import { useEffect, useRef, useState, useCallback } from 'react';\r\n\r\ninterface WebSocketMessage {\r\n  type: string;\r\n  data?: any;\r\n}\r\n\r\ninterface UseWebSocketOptions {\r\n  url: string;\r\n  onMessage?: (message: WebSocketMessage) => void;\r\n  onOpen?: () => void;\r\n  onClose?: () => void;\r\n  onError?: (error: Event) => void;\r\n  reconnectAttempts?: number;\r\n  reconnectInterval?: number;\r\n}\r\n\r\nexport const useWebSocket = ({\r\n  url,\r\n  onMessage,\r\n  onOpen,\r\n  onClose,\r\n  onError,\r\n  reconnectAttempts = 5,\r\n  reconnectInterval = 3000,\r\n}: UseWebSocketOptions) => {\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const [lastMessage, setLastMessage] = useState<WebSocketMessage | null>(null);\r\n  const ws = useRef<WebSocket | null>(null);\r\n  const reconnectTimeoutId = useRef<NodeJS.Timeout | null>(null);\r\n  const reconnectCount = useRef(0);\r\n\r\n  const connect = useCallback(() => {\r\n    try {\r\n      ws.current = new WebSocket(url);\r\n\r\n      ws.current.onopen = () => {\r\n        setIsConnected(true);\r\n        reconnectCount.current = 0;\r\n        onOpen?.();\r\n      };\r\n\r\n      ws.current.onmessage = (event) => {\r\n        try {\r\n          const message: WebSocketMessage = JSON.parse(event.data);\r\n          setLastMessage(message);\r\n          onMessage?.(message);\r\n        } catch (error) {\r\n          console.error('Failed to parse WebSocket message:', error);\r\n        }\r\n      };\r\n\r\n      ws.current.onclose = () => {\r\n        setIsConnected(false);\r\n        onClose?.();\r\n\r\n        // Attempt to reconnect if not at max attempts\r\n        if (reconnectCount.current < reconnectAttempts) {\r\n          reconnectCount.current += 1;\r\n          reconnectTimeoutId.current = setTimeout(() => {\r\n            connect();\r\n          }, reconnectInterval);\r\n        }\r\n      };\r\n\r\n      ws.current.onerror = (error) => {\r\n        console.error('WebSocket error:', error);\r\n        onError?.(error);\r\n      };\r\n    } catch (error) {\r\n      console.error('Failed to create WebSocket connection:', error);\r\n    }\r\n  }, [url, onMessage, onOpen, onClose, onError, reconnectAttempts, reconnectInterval]);\r\n\r\n  const disconnect = useCallback(() => {\r\n    if (reconnectTimeoutId.current) {\r\n      clearTimeout(reconnectTimeoutId.current);\r\n    }\r\n    if (ws.current) {\r\n      ws.current.close();\r\n    }\r\n  }, []);\r\n\r\n  const sendMessage = useCallback((message: any) => {\r\n    if (ws.current && ws.current.readyState === WebSocket.OPEN) {\r\n      ws.current.send(JSON.stringify(message));\r\n    } else {\r\n      console.warn('WebSocket is not connected');\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    connect();\r\n\r\n    return () => {\r\n      disconnect();\r\n    };\r\n  }, [connect, disconnect]);\r\n\r\n  return {\r\n    isConnected,\r\n    lastMessage,\r\n    sendMessage,\r\n    disconnect,\r\n    reconnect: connect,\r\n  };\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}